<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:comp="http://xmlns.jcp.org/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<o:importConstants type="tech.lapsa.insurance.crm.beans.i.RequestType" />

	<f:subview>

		<!-- >> toolbar -->
		<p:toolbar id="requestToolbar">
			<f:facet name="left">

				<h:panelGroup rendered="#{canView}">

					<p:commandButton icon="fa fa-refresh" process="@this"
						update="requestToolbar #{update}" />

					<p:selectBooleanButton value="#{settings.autoRefresh}"
						onLabel="Автообновление" offLabel="Автообновление"
						onIcon="fa fa-check" offIcon="fa">
						<p:ajax process="@this" update="@form:autoRefreshPoll" />
					</p:selectBooleanButton>

					<h:panelGroup styleClass="ui-separator">
						<h:panelGroup class="ui-icon ui-icon-grip-dotted-vertical" />
					</h:panelGroup>

					<p:commandButton value="Открыть..."
						disabled="#{empty rr.progressStatus}" process="@this"
						update="@form:requestDialog"
						oncomplete="PF('requestDialogWV').show(); return false;">
						<p:resetInput target="@form:requestDialog" />
					</p:commandButton>

				</h:panelGroup>

				<h:panelGroup rendered="#{canChange}">

					<h:panelGroup styleClass="ui-separator">
						<h:panelGroup class="ui-icon ui-icon-grip-dotted-vertical" />
					</h:panelGroup>

					<p:commandButton value="Начать обработку"
						icon="fa fa-play-circle-o"
						disabled="#{rr.progressStatus ne 'NEW'}"
						action="#{acceptRequest.doAccept}" process="@this"
						update="requestToolbar #{update}" />

					<p:commandButton value="Приостановить" icon="fa fa-pause-circle-o"
						disabled="#{rr.progressStatus ne 'ON_PROCESS'}"
						rendered="#{rr.progressStatus ne 'ON_HOLD'}"
						action="#{pauseRequest.doPause}" process="@this"
						update="requestToolbar #{update}" />

					<p:commandButton value="Возобновить" icon="fa fa-play-circle-o"
						disabled="#{rr.progressStatus ne 'ON_HOLD'}"
						rendered="#{rr.progressStatus eq 'ON_HOLD'}"
						action="#{resumeRequest.doResume}" process="@this"
						update="requestToolbar #{update}" />

					<p:commandButton value="Договор заключен..." icon="fa fa-check"
						disabled="#{rr.progressStatus eq 'FINISHED'}" process="@this"
						update="@form:transactionCompleteDialog"
						oncomplete="PF('transactionCompleteDialogWV').show(); return false;">
						<p:resetInput target="@form:transactionCompleteDialog" />
					</p:commandButton>

					<p:commandButton value="Договор не заключен..." icon="fa fa-ban"
						disabled="#{rr.progressStatus eq 'FINISHED' or rr.paymentStatus eq 'DONE'}"
						process="@this" update="@form:transactionUncompleteDialog"
						oncomplete="PF('transactionUncompleteDialogWV').show(); return false;">
						<p:resetInput target="@form:transactionUncompleteDialog" />
					</p:commandButton>

				</h:panelGroup>

				<h:panelGroup rendered="#{canClose}">
					<p:commandButton value="В архив" icon="fa fa-archive"
						disabled="#{rr.progressStatus ne 'FINISHED' or rr.requestStatus ne 'OPEN'}"
						action="#{closeRequest.doClose}" process="@this"
						update="requestToolbar #{update}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{canDelete}">
					<p:commandButton value="Удалить..." icon="fa fa-ban"
						disabled="#{rr.transactionStatus ne 'NOT_COMPLETED'}"
						process="@this" update="@form:deleteRequestDialog"
						oncomplete="PF('deleteRequestDialogWV').show(); return false;">
						<p:resetInput target="@form:deleteRequestDialog" />
					</p:commandButton>
				</h:panelGroup>

			</f:facet>

			<f:facet name="right">
				<h:outputText value="#{currentUser.value.name}" />
			</f:facet>

		</p:toolbar>
		<p:sticky target="requestToolbar" />
		<!-- << toolbar -->

	</f:subview>

</ui:composition>
